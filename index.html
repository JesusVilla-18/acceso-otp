<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Acceso con C√≥digo Email</title>
  <style>
    body { font-family: Arial; margin:40px; }
    input, button { display:block; margin:10px 0; padding:8px; }
    #mensaje { margin-top:20px; white-space: pre-line; border:1px solid #ccc; padding:10px; }
  </style>
</head>
<body>

<h2>Acceso con c√≥digo por correo</h2>

<input id="email" placeholder="Escribe tu correo">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<input id="codigo" placeholder="Escribe el c√≥digo recibido">
<button onclick="verificarCodigo()">Verificar</button>

<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxXpztFC6MvQHk2Bh--7hpLqiHf-FYkN5OqxQGj1huM71PnNvbOxRMLxVZzAfaKV0P7KA/exec";

function log(msg){ document.getElementById("mensaje").innerText += msg + "\n"; }

async function enviarCodigo() {
  document.getElementById("mensaje").innerText = "";
  const email = document.getElementById("email").value.trim();
  if (!email) { log("‚ùå Escribe tu correo."); return; }

  log("üîÑ Enviando c√≥digo al correo...");
  try {
    const resp = await fetch(`${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}`);
    const data = await resp.json();
    if (data.success) log("‚úÖ C√≥digo enviado. Revisa tu correo (expira en 2 minutos).");
    else log("‚ùå Error al enviar el c√≥digo.");
  } catch(e) {
    log("‚ùå Error real de sistema: " + e);
  }
}

async function verificarCodigo() {
  const email = document.getElementById("email").value.trim();
  const codigo = document.getElementById("codigo").value.trim();
  if (!email || !codigo) { log("‚ùå Debes completar ambos campos."); return; }

  try {
    const resp = await fetch(APPS_SCRIPT_URL, {
      method: "POST",
      headers: {'Content-Type':'application/x-www-form-urlencoded'},
      body: `email=${encodeURIComponent(email)}&codigo=${encodeURIComponent(codigo)}`
    });
    const data = await resp.json();
    if (data.valid) log("‚úÖ C√≥digo correcto. Acceso permitido.");
    else log("‚ùå C√≥digo incorrecto o expirado.");
  } catch(e) {
    log("‚ùå Error al verificar: " + e);
  }
}
</script>

</body>
</html>
