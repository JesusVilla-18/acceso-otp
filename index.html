<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Acceso OTP</title>
<style>
body { font-family: Arial; margin:40px; }
input, button { display:block; margin:10px 0; padding:8px; }
#mensaje { margin-top:20px; white-space: pre-line; padding:10px; border:1px solid #ccc; background:#f2f2f2; }
</style>
</head>
<body>

<h2>Acceso con c√≥digo OTP por correo</h2>

<input id="email" placeholder="Escribe tu correo">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<input id="codigo" placeholder="Escribe el c√≥digo recibido">
<button onclick="verificarCodigo()">Verificar</button>

<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxFve7wgPN4H4FYcExoP83DkiE09LlFbF9VbOjbJoPE9l8pZqow4KlUFuz7e3ri3rNiQg/exec";

function log(msg){ document.getElementById("mensaje").innerText += msg + "\n"; }

async function enviarCodigo(){
  document.getElementById("mensaje").innerText = "";
  const email = document.getElementById("email").value.trim();
  if(!email){ log("‚ùå Escribe tu correo"); return; }

  log("üì§ Enviando c√≥digo por correo...");
  try{
    const resp = await fetch(APPS_SCRIPT_URL + "?email=" + encodeURIComponent(email));
    const data = await resp.json();
    if(data.ok){
      log("‚úÖ C√≥digo enviado al correo: " + email);
      log("DEBUG: " + JSON.stringify(data.debug, null,2));
    } else {
      log("‚ùå Error: " + data.mensaje);
      log("DEBUG: " + JSON.stringify(data.debug || {}, null,2));
    }
  } catch(e){
    log("‚ùå Error al enviar el c√≥digo: " + e);
  }
}

async function verificarCodigo(){
  const email = document.getElementById("email").value.trim();
  const codigo = document.getElementById("codigo").value.trim();
  if(!email || !codigo){ log("‚ùå Completa correo y c√≥digo"); return; }

  log("üîÑ Verificando c√≥digo...");
  try{
    const resp = await fetch(APPS_SCRIPT_URL, {
      method:"POST",
      headers:{"Content-Type":"application/x-www-form-urlencoded"},
      body:`email=${encodeURIComponent(email)}&codigo=${encodeURIComponent(codigo)}`
    });
    const data = await resp.json();
    log(JSON.stringify(data, null, 2));
    if(data.ok){
      log("‚úÖ C√≥digo correcto");
      document.getElementById("mensaje").innerHTML +=
    '<br>üîó Link: <a href="' + data.link + '" target="_blank">' + data.link + '</a>';
    } else {
      log("‚ùå " + data.mensaje);
    }
  } catch(e){
    log("‚ùå Error al verificar el c√≥digo: " + e);
  }
}
</script>

</body>
</html>

