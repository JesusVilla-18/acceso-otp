<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Acceso con c√≥digo</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    input, button { display:block; margin:10px 0; padding:8px; }
    #mensaje { margin-top:20px; white-space: pre-line; }
  </style>
</head>
<body>

<h2>Acceso con c√≥digo por correo</h2>

<input id="email" placeholder="Escribe tu correo">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<input id="codigo" placeholder="Escribe el c√≥digo recibido">
<button onclick="verificarCodigo()">Verificar c√≥digo</button>

<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby1voZOCYVu3eyWm6sN9GPSrtTVifZFPQg4kLxEE6eUQErMFPD--X8mu_3MFXzMisdiaA/exec";

function log(msg){
  document.getElementById("mensaje").innerText = msg;
}

async function enviarCodigo(){
  const email = document.getElementById("email").value.trim();
  if(!email){ log("‚ùå Escribe un correo"); return; }

  log("üì§ Enviando c√≥digo por correo...");

  try {
    const resp = await fetch(`${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}`);
    const data = await resp.json();

    if(!data.existe){
      log("‚ùå Correo no autorizado");
      return;
    }

    log("‚úÖ C√≥digo enviado. Revisa tu correo (v√°lido 2 min).");

  } catch(e){
    console.error(e);
    log("‚ùå Error al enviar el c√≥digo");
  }
}

async function verificarCodigo(){
  const email = document.getElementById("email").value.trim();
  const codigo = document.getElementById("codigo").value.trim();
  if(!email || !codigo){ log("‚ùå Completa ambos campos"); return; }

  log("üîÑ Verificando c√≥digo...");

  try {
    const form = new URLSearchParams();
    form.append("email", email);
    form.append("codigo", codigo);

    const resp = await fetch(APPS_SCRIPT_URL, {
      method: "POST",
      body: form
    });

    const data = await resp.json();

    if(!data.ok){
      log("‚ùå " + data.mensaje);
      return;
    }

    log("‚úÖ C√≥digo correcto!\nüîó Tu archivo: " + data.link);

  } catch(e){
    console.error(e);
    log("‚ùå Error al verificar c√≥digo");
  }
}
</script>

</body>
</html>
