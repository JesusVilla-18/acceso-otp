<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Acceso por correo</title>
<style>
body { font-family: Arial; margin: 40px; }
input, button { display:block; margin:10px 0; padding:8px; }
#mensaje { margin-top:20px; background:#f2f2f2; padding:10px; border:1px solid #ccc; white-space: pre-line; }
</style>
</head>
<body>

<h2>Acceso con c√≥digo por correo</h2>

<input id="email" placeholder="Escribe tu correo">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<br>

<input id="codigo" placeholder="Escribe el c√≥digo recibido">
<button onclick="verificarCodigo()">Verificar</button>

<h3>Registro:</h3>
<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyFve7wgPN4H4FYcExoP83DkiE09LlFbF9VbOjbJoPE9l8pZqow4KlUFuz7e3ri3rNiQg/exec";

let emailGlobal = "";

function log(msg){
  document.getElementById("mensaje").innerText += "\n" + msg;
}

async function enviarCodigo() {
  document.getElementById("mensaje").innerText = "";
  const email = document.getElementById("email").value.trim();
  if (!email.includes("@")) {
    log("‚ùå Ingresa un correo v√°lido.");
    return;
  }
  emailGlobal = email;
  log("üì§ Enviando c√≥digo por correo...");

  try {
    const url = `${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&callback=callback`;
    
    await fetch(url); // usamos JSONP, la respuesta no nos importa
    log("‚úÖ C√≥digo enviado si el correo estaba autorizado.");

  } catch(e) {
    log("‚ùå Error al consultar la base de datos.");
    console.error(e);
  }
}

async function verificarCodigo() {
  const codigo = document.getElementById("codigo").value.trim();
  if (!codigo || !emailGlobal) {
    log("‚ùå Primero solicita el c√≥digo.");
    return;
  }

  try {
    // Llamada a la funci√≥n de validaci√≥n
    const resp = await fetch(`${APPS_SCRIPT_URL}?email=${encodeURIComponent(emailGlobal)}&codigo=${codigo}&accion=validar`);
    const texto = await resp.text();
    log("üì• Resultado de validaci√≥n: " + texto);
    // El Apps Script puede devolver true/false
  } catch(e) {
    log("‚ùå Error al verificar c√≥digo.");
  }
}
</script>

</body>
</html>
