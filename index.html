<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>OTP por correo</title>
<style>
body{font-family:Arial;margin:40px;}
input,button{display:block;margin:10px 0;padding:8px;}
#mensaje{margin-top:20px;background:#f2f2f2;padding:10px;white-space:pre-line;border:1px solid #ccc;}
</style>
</head>
<body>

<h2>Acceso con c√≥digo por correo</h2>

<input id="email" placeholder="Correo institucional">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<input id="codigo" placeholder="C√≥digo recibido">
<button onclick="verificarCodigo()">Verificar c√≥digo</button>

<h3>Registro:</h3>
<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzwMMQtUggCkgcTVBt_ZPeMq74B3CSq0L_wgRSSuJCoV2VVJpZiAdYGXo3_J8IykVdrtA/exec";

function log(msg){document.getElementById("mensaje").innerText += msg+"\n";}

function enviarCodigo(){
  document.getElementById("mensaje").innerText="";
  const email = document.getElementById("email").value.trim();
  if(!email){ log("‚ùå Escribe un correo"); return; }

  log("üì§ Enviando c√≥digo por correo...");

  const cb = "cb" + Date.now();
  window[cb] = function(data){
    if(data.enviado) log("‚úÖ C√≥digo enviado. Revisa tu correo.");
    else log("‚ùå Error: " + data.error);
    delete window[cb];
  };

  const s = document.createElement("script");
  s.src = `${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&callback=${cb}`;
  document.body.appendChild(s);
  s.remove();
}

function verificarCodigo(){
  const email = document.getElementById("email").value.trim();
  const codigo = document.getElementById("codigo").value.trim();
  if(!email || !codigo){ log("‚ùå Escribe correo y c√≥digo"); return; }

  log("üîÑ Verificando c√≥digo...");

  const cb = "cb" + Date.now();
  window[cb] = function(data){
    if(data.existe){
      log("‚úÖ C√≥digo correcto. Link:");
      log(data.link);
    } else {
      log("‚ùå " + (data.error || "C√≥digo incorrecto o vencido"));
    }
    delete window[cb];
  };

  const s = document.createElement("script");
  s.src = `${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&codigo=${codigo}&callback=${cb}`;
  document.body.appendChild(s);
  s.remove();
}
</script>

</body>
</html>
