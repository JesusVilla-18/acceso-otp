<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Acceso con c√≥digo por correo</title>
  <style>
    body { font-family: Arial; margin:40px; }
    input, button { display:block; margin:10px 0; padding:8px; width:300px; }
    #mensaje {
      margin-top:20px;
      background:#f2f2f2;
      padding:10px;
      white-space: pre-line;
      border:1px solid #ccc;
    }
  </style>
</head>
<body>

<h2>Acceso con c√≥digo por correo</h2>

<input id="email" placeholder="Escribe tu correo">
<button onclick="enviarCodigo()">Enviar c√≥digo</button>

<br>

<input id="codigo" placeholder="Escribe el c√≥digo recibido">
<button onclick="verificarCodigo()">Verificar c√≥digo</button>

<h3>Registro de sistema:</h3>
<p id="mensaje"></p>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx3-06UCQorPkEcD0tYLc9_ZQ0H9g_ORkaSxasfmQ42dbdaTgmihe8CGcStf9M_lrav0Q/exec";

let codigoGenerado = null; // c√≥digo enviado
let correoGlobal = "";

// funci√≥n para logs
function log(msg){
  document.getElementById("mensaje").innerText += "\n" + msg;
}

// -------------------- ENVIAR C√ìDIGO --------------------
function enviarCodigo(){
  document.getElementById("mensaje").innerText = "";
  const email = document.getElementById("email").value.trim();
  if(!email){ log("‚ùå Escribe un correo"); return; }

  correoGlobal = email;
  log("üì§ Enviando c√≥digo por correo...");

  const cb = "cb" + Date.now();
  window[cb] = function(data){
    if(data.enviado){
      codigoGenerado = data.codigo; // guardamos c√≥digo temporalmente
      log("‚úÖ C√≥digo enviado. Revisa tu correo (v√°lido 2 min).");
    } else {
      log("‚ùå Error al enviar c√≥digo: " + (data.error || "desconocido"));
    }
    delete window[cb];
    document.body.removeChild(script);
  };

  const script = document.createElement("script");
  script.src = `${APPS_SCRIPT_URL}?email=${encodeURIComponent(email)}&callback=${cb}`;
  document.body.appendChild(script);
}

// -------------------- VERIFICAR C√ìDIGO --------------------
function verificarCodigo(){
  const codigo = document.getElementById("codigo").value.trim();
  if(!codigoGenerado){
    log("‚ùå Primero solicita el c√≥digo.");
    return;
  }
  if(codigo !== codigoGenerado){
    log("‚ùå C√≥digo incorrecto o expirado.");
    return;
  }

  log("‚úÖ C√≥digo correcto.");
  
  // Mostrar link de Drive (ejemplo)
  log("üîó Aqu√≠ est√° tu archivo: https://drive.google.com/tu-enlace-aqui");
}
</script>

</body>
</html>
